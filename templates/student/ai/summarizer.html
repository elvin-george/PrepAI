<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note Summarizer - GradMate AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        secondary: {
                            50: '#f0fdfa',
                            100: '#ccfbf1',
                            200: '#99f6e4',
                            300: '#5eead4',
                            400: '#2dd4bf',
                            500: '#14b8a6',
                            600: '#0d9488',
                            700: '#0f766e',
                            800: '#115e59',
                            900: '#134e4a',
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CustomScrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .dark ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }
    </style>
</head>

<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <div class="flex h-screen bg-gray-50 dark:bg-gray-900">

        <!-- Sidebar -->
        {% include 'includes/sidebar.html' %}

        <!-- Main Content -->
        <div class="flex-1 flex flex-col min-h-0">
            <!-- Top Navigation -->
            {% include 'includes/navbar.html' %}

            <!-- Main Content -->
            <main class="p-6 overflow-y-auto relative z-0">
                <!-- Header Section -->
                <div class="mb-8 text-center animate-fade-in-down">
                    <div
                        class="w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-blue-500/30">
                        <i class="fas fa-magic text-white text-2xl"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
                        AI Note Summarizer
                    </h2>
                    <p class="text-gray-600 dark:text-gray-400 max-w-xl mx-auto">
                        Turn messy notes into clear, concise summaries in seconds. Perfect for last-minute revision.
                    </p>
                </div>

                <!-- Input Section -->
                <div class="max-w-4xl mx-auto mb-8">
                    <div
                        class="bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-6 shadow-sm">
                        <div class="mb-4">
                            <label for="notesInput"
                                class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2 uppercase tracking-wider">
                                Source Material
                            </label>
                            <div class="relative">
                                <textarea id="notesInput" rows="10"
                                    class="w-full px-4 py-3 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-gray-900/50 text-gray-900 dark:text-white placeholder-gray-400 resize-none transition-all"
                                    placeholder="Paste your lecture notes, articles, or text here..."></textarea>

                                <!-- Character Counter -->
                                <div class="absolute bottom-3 right-3 text-xs font-mono text-gray-400">
                                    <span id="charCount">0</span> chars
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex flex-col sm:flex-row gap-3">
                            <button onclick="summarize()" id="sumBtn"
                                class="flex-1 bg-gray-900 dark:bg-white text-white dark:text-gray-900 font-bold py-3 px-6 rounded-xl hover:opacity-90 transition-all flex items-center justify-center shadow-lg shadow-gray-200 dark:shadow-none">
                                <i class="fas fa-sparkles mr-2"></i>
                                Summarize Now
                            </button>

                            <button onclick="clearText()"
                                class="px-6 py-3 border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                <i class="fas fa-trash-alt mr-2"></i>
                                Clear
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Summary Output Section -->
                <div id="outputArea" class="max-w-4xl mx-auto hidden animate-fade-in-up">
                    <div
                        class="bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-8 shadow-sm">
                        <div
                            class="flex items-center justify-between mb-6 pb-4 border-b border-gray-100 dark:border-gray-700">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                <i class="fas fa-align-left text-primary-500"></i>
                                Summary
                            </h3>
                            <div class="flex space-x-2">
                                <button onclick="copySummary()"
                                    class="text-xs font-bold text-gray-500 hover:text-primary-600 px-3 py-1.5 bg-gray-50 dark:bg-gray-700 rounded-lg transition-colors">
                                    <i class="fas fa-copy mr-1"></i> Copy
                                </button>
                            </div>
                        </div>

                        <div id="summaryContent"
                            class="prose prose-sm max-w-none dark:prose-invert text-gray-600 dark:text-gray-300 leading-relaxed">
                            <!-- Content goes here -->
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <script>
        const notesInput = document.getElementById('notesInput');
        const charCount = document.getElementById('charCount');

        notesInput.addEventListener('input', () => {
            charCount.innerText = notesInput.value.length;
        });

        function clearText() {
            notesInput.value = '';
            charCount.innerText = '0';
            document.getElementById('outputArea').classList.add('hidden');
        }

        async function summarize() {
            const text = notesInput.value;
            const btn = document.getElementById('sumBtn');

            if (!text) return alert("Please enter some text first!");

            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Processing...';
            btn.disabled = true;

            try {
                const res = await fetch('/student/api/summarize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });

                if (res.status === 503 || res.status === 500) {
                    const errData = await res.json();
                    alert(errData.error || "Service unavailable. Please try again.");
                    throw new Error("API Error");
                }

                const data = await res.json();

                // Format Markdown-ish text to HTML
                let html = data.summary
                    .replace(/\*\*(.*?)\*\*/g, '<strong class="text-gray-900 dark:text-white">$1</strong>')
                    .replace(/^\* /gm, '<li class="ml-4 list-disc marker:text-primary-500 mb-1">')
                    .replace(/\n/g, '<br>');

                document.getElementById('summaryContent').innerHTML = html;
                document.getElementById('outputArea').classList.remove('hidden');

            } catch (e) {
                console.error(e);
            } finally {
                btn.innerHTML = '<i class="fas fa-sparkles mr-2"></i> Summarize Now';
                btn.disabled = false;
            }
        }

        function copySummary() {
            const text = document.getElementById('summaryContent').innerText;
            navigator.clipboard.writeText(text);
            alert("Copied to clipboard!");
        }
    </script>
</body>

</html>